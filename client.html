<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <title><<CONNECTIONTITLE>></title>
        <script type="text/javascript" src="/guacamole/guacamole-common-js/all.js"></script>
        <script>
            // We place the Guacamole connection in a full-window iframe to hide the username and password values we're passing in on the URL.
            // Guacamole's documentation points out that this is something of a cludge, and messes up the keyboard focus, which then needs
            // fixing - see: https://guacamole.apache.org/faq/#iframes
            var refocusGuacamole = function refocusGuacamole() {
                // Do not refocus if focus is on an input field
                var focused = document.activeElement;
                if (focused && focused !== document.body)
                    return;
                // Ensure the connection iframe is focused.
                document.getElementById("guacIframe").focus();
            };
            
            function setup() {
                // Attempt to refocus the connection iframe upon click or keydown.
                //document.addEventListener('click', refocusGuacamole);
                //document.addEventListener('keydown', refocusGuacamole);
                
                // Get display div from document
                var display = document.getElementById("display");
                
                // Instantiate client, using an HTTP tunnel for communications.
                var guac = new Guacamole.Client(new Guacamole.HTTPTunnel("tunnel"));
                
                // Add client to display div
                display.appendChild(guac.getDisplay().getElement());
                
                // Error handler
                guac.onerror = function(error) {
                    alert(error);
                };
                
                // Connect
                guac.connect();
                
                // Disconnect on close
                window.onunload = function() {
                    guac.disconnect();
                }
            }
        </script>
    </head>
    <body style="height:100vh; margin:0; padding:0;" onload="setup()">
        <!-- <iframe id="guacIframe" style="width:100%; height:100%; border:0" src="<<CONNECTIONURL>>"></iframe> -->
        
        <!-- Display -->
        <div id="display"></div>
    </body>
</html>
